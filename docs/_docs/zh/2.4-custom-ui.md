---
title: ä¸ªæ€§åŒ– UI
permalink: /docs/zh/custom-ui.html
key: docs-custom-ui
---


å¬è¯´ä½ å«Œå¼ƒæ’­æ”¾å™¨é»˜è®¤ UI å¤ªä¸‘ ğŸ˜«ï¼Œæˆ–è€…å°‘äº†ä½ æƒ³è¦çš„æ˜¾ç¤ºç»„ä»¶ ğŸ˜‚ï¼Ÿ  
æ²¡å…³ç³»ï¼Œä½ å®Œå…¨å¯ä»¥æŒ‰ç…§ä½ çš„æƒ³æ³•é‡æ–°å®ç°æ’­æ”¾å™¨æ§åˆ¶ UIã€‚  

è¯»å®Œè¿™ä¸€èŠ‚çš„å†…å®¹ï¼Œä½ å°±èƒ½å¤ŸæŒæ¡äº†å¦‚ä½•è‡ªå®šä¹‰æ’­æ”¾å™¨æ§åˆ¶ UIã€‚


## è‡ªå®šä¹‰ UI æ¥å£

ä¹‹å‰åœ¨æ’­æ”¾å™¨å¡«å……å’Œè£å‰ªçš„æ–‡æ¡£ä¸­è®²åˆ° `FijkView` æ„é€ å‡½æ•°ä¸­çš„å‚æ•°ï¼Œçœå»äº†å’Œç¼©æ”¾è£å‰ªæ— å…³çš„å‚æ•°ã€‚
åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œå°±è¦ä»è¿™çœå»çš„å‚æ•°ä¸­è¯´èµ·ã€‚

```dart
typedef FijkPanelWidgetBuilder = Widget Function(
    FijkPlayer player, BuildContext context, Size viewSize, Rect texturePos);

FijkView({
    @required FijkPlayer player,
    double width,
    double height,
    Color color = Colors.blueGrey,
    FijkFit fit = FijkFit.contain,
    FijkPanelWidgetBuilder panelBuilder,
}) 
```

`FijkPanelWidgetBuilder` æ˜¯ä¸€ä¸ªç”¨äº build æ’­æ”¾å™¨æ§åˆ¶ UI çš„å‡½æ•°ç­¾åã€‚åœ¨ `FijkView` çš„ç¼ºçœæ„é€ ä¸­ï¼Œ`panelBuilder` ä¹Ÿæœ‰ä¸€ä¸ªç¼ºçœçš„å®ç°ï¼Œæ•ˆæœå°±æ˜¯ä½ çœ‹åˆ°çš„é‚£ä¸ªä¸‘ä¸‘çš„æ§åˆ¶ UIã€‚

### æ¥å£å‚æ•° 

å…ˆè¯´ä¸€ä¸‹ `FijkPanelWidgetBuilder` å‡½æ•°ç­¾åä¸­çš„è¿™å‡ ä¸ªå‚æ•°ï¼š  
* `player` æ’­æ”¾å™¨ FijkPlayer å¯¹è±¡ï¼ŒFijkView æ‰€æ˜¾ç¤ºè§†é¢‘çš„æ•°æ®æ¥æºï¼Œè‡ªå®šä¹‰UIæ‰€æ§åˆ¶çš„æ’­æ”¾å™¨å¯¹è±¡ã€‚  
ç›‘å¬æ­¤ player çš„å±æ€§å˜åŒ–å¹¶åœ¨ UI ä¸Šä½œå‡ºç›¸åº”çš„æ”¹å˜ã€‚
* `context` build Widget çš„ä¸Šä¸‹æ–‡ã€‚
* `viewSize` å¯¹åº” FijkView çš„å®é™…æ˜¾ç¤ºå¤§å°
* `texturePos` FijkView ä¸­å®é™…è§†é¢‘æ˜¾ç¤ºçš„ç›¸å¯¹ä½ç½®ï¼Œè¿™ä¸ªç›¸å¯¹ä½ç½®å¯èƒ½è¶…å‡º `FijkView` çš„å®é™…å¤§å°

ç»“åˆ [æ’­æ”¾å™¨å¡«å……ä¸è£å‰ª](docs/zh/fijkfit.html) ä¸­çš„å†…å®¹ï¼Œå¯ä»¥å¯¹ `viewSize` å’Œ `texturePos` ä¸¤ä¸ªå‚æ•°æœ‰æ›´å¥½çš„ç†è§£ã€‚  
* åœ¨ `FijkFit.contain` æ¨¡å¼ä¸‹ï¼Œ`texturePos` æ˜¯ç»å¯¹ä¸ä¼šè¶…å‡º `viewSize` çš„å¤§å°ã€‚
* åœ¨ `FijkFit.fill` æ¨¡å¼ä¸‹ï¼Œ`texturePos` çš„å®½é«˜è‚¯å®šæ˜¯å’Œ `viewSize` çš„å®½é«˜ç›¸ç­‰ï¼Œ`texturePos` çš„ç›¸å¯¹åç§»æ˜¯ 0ã€‚
* åœ¨ `FijkFit.cover` æ¨¡å¼ï¼Œä¸” FijkView å®½é«˜æ¯”ä¾‹å’Œå®é™…è§†é¢‘å®½é«˜æ¯”ä¾‹ä¸ç­‰çš„æƒ…å†µä¸‹ï¼Œ`texturePos` å®½é«˜è‚¯å®šè¶…å‡º `viewSize` çš„å¤§å°ã€‚

### è¿”å›å€¼

`FijkPanelWidgetBuilder` è¿”å›çš„ Widget å®é™…ä¸Šä¼šåœ¨ç»„ä»¶æ ‘ä¸­ä½œä¸ºä¸€ä¸ª `Stack` ç»„ä»¶çš„å­ç»„ä»¶ï¼Œ`texturePos` å°±æ˜¯è§†é¢‘æ˜¾ç¤ºåŒºåŸŸåœ¨ `Stack` ä¸­çš„ç›¸å¯¹ä½ç½® æ‰€ä»¥è¿”å›ä¸€ä¸ª `Positioned` ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

`FijkPanelWidgetBuilder` è¿”å›çš„ Widget è¦†ç›–åœ¨  `Stack` å­ç»„ä»¶ `Texture` (å®é™…æ¸²æŸ“è§†é¢‘çš„ç»„ä»¶) çš„ä¸Šæ–¹ã€‚

## ç‰›åˆ€å°è¯•

åˆ©ç”¨ä¸Šé¢æè¿°çš„è‡ªå®šä¹‰æ’­æ”¾å™¨æ§åˆ¶ UI çš„æ¥å£ï¼Œæˆ‘ä»¬å®é™…ç¼–ç å®ç°ä¸€ä¸ªéå¸¸ç®€å•çš„ UIã€‚

UI æè¿°ï¼š åœ¨è§†é¢‘æ˜¾ç¤ºåŒºåŸŸçš„å·¦ä¸‹è§’æ ¹æ®å®é™…æ’­æ”¾å™¨çŠ¶æ€æ˜¾ç¤ºä¸€ä¸ªæ’­æ”¾ã€æš‚åœæŒ‰é’®ã€‚

### æ— çŠ¶æ€ UI ï¼Ÿ
```dart
Widget simplestUI(FijkPlayer player, BuildContext context, Size viewSize, Rect texturePos) {
  // texturePos å¯èƒ½è¶…å‡º viewSize å¤§å°ï¼Œæ‰€ä»¥å…ˆè¿›è¡Œå¤§å°çº¦æŸã€‚
  Rect rect = Rect.fromLTRB(
      max(0.0, texturePos.left),
      max(0.0, texturePos.top),
      min(viewSize.width, texturePos.right),
      min(viewSize.height, texturePos.bottom));
  bool isPlaying = player.state == FijkState.started;
  return Positioned.fromRect(
    rect: rect,
    child: Container(
      alignment: Alignment.bottomLeft,
      child: IconButton(
        icon: Icon(
          isPlaying ? Icons.pause : Icons.play_arrow,
          color: Colors.white,
        ),
        onPressed: () {
          isPlaying ? player.pause() : player.start();
        },
      ),
    ),
  );
}
```

è¿™æ˜¯ä¸€ä¸ªå‡ ä¹æœ€ç®€å•çš„æ’­æ”¾å™¨æ§åˆ¶ UI äº†ï¼Œåªæœ‰ä¸€ä¸ªæ ¹æ®å½“å‰çŠ¶æ€æ˜¾ç¤ºçš„æ’­æ”¾æˆ–è€…æš‚åœæŒ‰é’®ã€‚  
å°† `simplestUI` ä½œä¸º `panelBuilder` å‚æ•°å€¼ï¼Œå®ƒèƒ½å¤Ÿæ­£å¸¸å·¥ä½œå—ï¼Ÿ

æˆ‘æ¥å‘Šè¯‰ä½ ç­”æ¡ˆå§ã€‚  
é¦–å…ˆ `simplestUI` æˆåŠŸæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œå¹¶ä¸”æ­£æ˜¯åœ¨æˆ‘ä»¬æƒ³è¦çš„ä½ç½®ä¸Šã€‚æ’­æ”¾å™¨åŠ è½½è¿‡ç¨‹æ˜¾ç¤ºäº†æ’­æ”¾ç®­å¤´ï¼Œå¼€å§‹æ’­æ”¾åæ˜¾ç¤ºäº†æš‚åœå›¾æ ‡ã€‚  
å“ªé‡Œä¸æ­£å¸¸å‘¢ï¼Ÿ æ’­æ”¾å™¨æ’­æ”¾å®Œæˆåï¼Œå›¾æ ‡è¿˜æ˜¯æš‚åœå›¾æ ‡ï¼Œæ²¡æœ‰æ›´æ–°ã€‚ æ’­æ”¾è¿‡ç¨‹ä¸­ç‚¹å‡»æŒ‰é’®ï¼Œæ’­æ”¾å™¨ç¡®å®æš‚åœäº†ï¼Œä½†æ˜¯å›¾æ ‡æ²¡æœ‰å˜åŒ–ã€‚  
è¿™ä¸€åˆ‡éƒ½æ˜¯å› ä¸º `simplestUI` æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸èƒ½é€šè¿‡ `setState` è¿›è¡Œ UI åˆ·æ–°ã€‚

ä½†æ˜¯ä¸ºä»€ä¹ˆå¼€å§‹æ’­æ”¾å‰åï¼Œ`simplestUI` çš„å›¾æ ‡ä¼šå˜åŒ–ä¸€æ¬¡å‘¢ï¼Ÿ  
å› ä¸º `FijkView` æœ¬èº«ç›‘å¬äº†æ’­æ”¾å™¨ prepared çŠ¶æ€ï¼Œè·å–äº†è§†é¢‘åƒç´ å®½é«˜å¹¶ä¸”è¿›è¡Œäº† UI é‡ç»˜ï¼Œ`simplestUI` è¿”å›çš„æ— çŠ¶æ€ Widget ä½œä¸º `FijkView` ç»„ä»¶æ ‘ä¸­çš„ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿè¢«åˆ·æ–°äº†ã€‚
 

### æœ‰çŠ¶æ€ UI
```dart
class CustomFijkPanel extends StatefulWidget {
  final FijkPlayer player;
  final BuildContext buildContext;
  final Size viewSize;
  final Rect texturePos;

  const CustomFijkPanel({
    @required this.player,
    this.buildContext,
    this.viewSize,
    this.texturePos,
  });

  @override
  _CustomFijkPanelState createState() => _CustomFijkPanelState();
}

class _CustomFijkPanelState extends State<CustomFijkPanel> {

  FijkPlayer get player => widget.player;
  bool _playing = false;

  @override
  void initState() {
    super.initState();
    widget.player.addListener(_playerValueChanged);
  }

  void _playerValueChanged() {
    FijkValue value = player.value;

    bool playing = (value.state == FijkState.started);
    if (playing != _playing) {
      setState(() {
        _playing = playing;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    Rect rect = Rect.fromLTRB(
        max(0.0, widget.texturePos.left),
        max(0.0, widget.texturePos.top),
        min(widget.viewSize.width, widget.texturePos.right),
        min(widget.viewSize.height, widget.texturePos.bottom));

    return Positioned.fromRect(
      rect: rect,
      child: Container(
        alignment: Alignment.bottomLeft,
        child: IconButton(
          icon: Icon(
            _playing ? Icons.pause : Icons.play_arrow,
            color: Colors.white,
          ),
          onPressed: () {
            _playing ? widget.player.pause() : widget.player.start();
          },
        ),
      ),
    );
  }

  @override
  void dispose() {
    super.dispose();
    player.removeListener(_playerValueChanged);
  }
}
```

`CustomFijkPanel` æ˜¯ä¸Šä¸€ä¸ª `simplestUI` çš„æœ‰çŠ¶æ€ç‰ˆæœ¬ï¼Œå¹¶ä¸”é€šè¿‡ `widget.player.addListener(_playerValueChanged)` ç›‘å¬æ’­æ”¾å™¨çŠ¶æ€å˜åŒ–ï¼Œä¸»åŠ¨åˆ·æ–° UIã€‚

ä½œä¸º `panelBuilder` å‚æ•°ä¼ é€’ç»™ FijkView çš„æ„é€ å‡½æ•°ã€‚å¹¶ä¸”è¾¾åˆ°äº†æˆ‘ä»¬åœ¨å‰é¢æ‰€æè¿°çš„é¢„æœŸæ•ˆæœã€‚

```dart
FijkView(
  player: player,
  panelBuilder: (FijkPlayer player, BuildContext context, Size viewSize, Rect texturePos) {
    return CustomFijkPanel(
      player: player,
      buildContext: context,
      viewSize: viewSize,
      texturePos: texturePos);
  },
)
```

## æœŸå¾…ä½ çš„æ°ä½œ

å¥½äº†ï¼Œè‡ªå®šä¹‰ UI çš„æ¥å£è¯´æ˜å’Œå®é™…æ¡ˆä¾‹ï¼Œéƒ½å·®ä¸å¤šè®²å®Œäº†ã€‚é˜…è¯»åˆ°è¿™é‡Œä½ åº”è¯¥å¯ä»¥å®ç°è‡ªå·±æ¼‚äº®çš„æ’­æ”¾å™¨æ§åˆ¶ UI äº†ã€‚  
æœŸå¾…ä½ èƒ½å¤Ÿåˆ†äº«æ¼‚äº®çš„æ’­æ”¾å™¨æ§åˆ¶ UIï¼Œå¦‚æœå¯ä»¥è´¡çŒ® pull request æ›´æ˜¯æ„Ÿæ¿€ä¸å°½ã€‚  

å½“ç„¶ï¼Œå¦‚æœè¿˜æœ‰ä»€ä¹ˆä¸æ˜ç™½çš„ï¼Œå°½ç®¡åœ¨ [issues](https://github.com/befovy/fijkplayer/issues) ä¸­æå‡ºæ¥ã€‚

